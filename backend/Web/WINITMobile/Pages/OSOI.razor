@page "/osoi"
@page "/osoi/{From}"
@inherits WINITMobile.Pages.Base.BaseComponentBase
@using System.IO
@using Microsoft.AspNetCore.Components
@using Winit.UIComponents.Common
@using Winit.Shared.Models.Common
@using Winit.Modules.Planogram.BL.Interfaces
@inject Winit.Modules.Mapping.BL.Interfaces.ISelectionMapCriteriaBL _selectionMapCriteriaBL
@inject Winit.Modules.Planogram.BL.Interfaces.IPlanogramViewModel _planogramViewModel
@inject WINITMobile.Data.IImageUploadService _imageUploadService
@inject Winit.Modules.StoreActivity.BL.Interfaces.IStoreActivityViewModel _StoreActivityViewmodel


<!-- Planogram Execution View -->
<div class="cls_section1 rounded">
    <div class="cls_section2">
        <h4 style="font-size:18px;font-weight:600;margin-top: 10px !important;" class="mt-2">@((IsPlanogram ? "Planogram" : "OSOI Photo Capture"))</h4>
        <!-- Header -->
         <div class="cls_container_div4" style="width:100%;margin-right: 10px;margin-top:10px;">
             
                @if (IsPlanogram)
                {
                      <div class="cls_section_div">
                    <!-- Recommended Image Section -->
                    <label class="cls_section_label1">Recommended Image:</label>
                    <div class="no-image-placeholder">
                        <img style="width:100%;"
                             src="@((planogramSetupV1 != null && planogramSetupV1.ImageUrl != null)
            ? (_appConfigs.ApiDataBaseUrl + planogramSetupV1.ImageUrl) : Noimage)" />
                    </div>
                     </div>
                }
         </div>
        <div class="cls_container_div4" style="width: 78%;margin-right: 10px;margin-top:10px;">
          
           
            <div class="mt-3 dn">
                <label class="cls_section_label1">1. Is Shelf Arranged?</label><br />
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="shelfArranged" id="shelfYes" value="Yes" @onchange=@(() => OnRadioChange("Yes"))>
                    <label class="form-check-label" for="shelfYes">Yes</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="shelfArranged" id="shelfNo" value="No" @onchange=@(() => OnRadioChange("No"))>
                    <label class="form-check-label" for="shelfNo">No</label>
                </div>
            </div>

            <!-- Q2: Select Asset Type -->
            <div style="margin-top:0px">
                <label class="cls_section_label1">Select Asset Type</label><br />
                <div class="form-group mb-3">
                    <div class="form-group">
                        <Winit.UIComponents.Common.CustomControls.DropDown DataSource="assetTypeDataSource"
                                                                           OnSelect="OnFeedbackTypeSelected"
                                                                           Title="Asset Type"
                                                                           _SelectionMode="Winit.Shared.Models.Enums.SelectionMode.Single"
                                                                           IsButtonVisible="true" />
                    </div>
                </div>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(selectedAssetType))
        {
            <div class="cls_container_div" style="float: left;width: 17%;margin-top: 10px;">
                <h5 class="cls_section_label1 dn">Capture Image for @selectedAssetType:</h5>

                <FileCapture @key=@FileKey OnImageDeleteClick="OnImageDeleteClick"
                             OnImageCapture="OnImageCapture"
                             FolderPath="@ImgFolderPath"
                             FileName="OSOI"
                             CaptureData="@fileCaptureData" ShowCapturedImages=false>
                </FileCapture>
            </div>
        }
    </div>
</div>
@if (CapturedImagesByAssetType != null && CapturedImagesByAssetType.Any(g => g.Value != null && g.Value.Any()))
{
    <div class="div1">
        <table class="table" style="table-layout:fixed">
            <thead>
                <tr>
                    <th>Asset Type</th>
                    <th>Image</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var group in CapturedImagesByAssetType.Where(g => g.Value != null && g.Value.Any()))
                {
                    @foreach (var file in group.Value)
                    {
                        <tr>
                            <td>@group.Key</td>
                            <td>
                                <img src="data:image/jpeg;base64,@file.FileData" width="55" height="45" @onclick="() => ShowImage(file)" />
                            </td>
                            <td>
                                <a @onclick="() => DeleteCapturedImage(group.Key, file.FileName)">
                                    <img style="width:22px;" src="/Images/delete1.png">
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
}
@if (popupVisible)
{
    <div class="modal-backdrop fade show"></div>
    <div class="modal fade show" tabindex="-1" style="display: block;">
        <div style="display:flex; flex-direction:column; height:100vh; justify-content:center;">
            <div class="modal-content">
                <div class="modal-header">
                    <label></label>
                    <button type="button" class="close" @onclick="() => popupVisible = false">
                        <span style="color:black; padding:10px;width:100%">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <img src="data:image/jpeg;base64,@selectedImage.FileData" class="img-fluid" id="capturedImage" />
                </div>
            </div>
        </div>
    </div>
}
<div class="cls_dashboard_7" style="width:100%">
    <button class="cls_continue_btn" @onclick="OnPlanogramOSOISubmit">Submit</button>
</div>