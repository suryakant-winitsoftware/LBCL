@page "/Planogram"
@inherits WINITMobile.Pages.Base.BaseComponentBase
@using System.IO
@using Microsoft.AspNetCore.Components
@using Winit.UIComponents.Common
@using Winit.Shared.Models.Common
@using Winit.Modules.Planogram.BL.Interfaces
@inject Winit.Modules.Planogram.BL.Interfaces.IPlanogramViewModel _viewModel

@if (_viewModel.ShowCategoryList)
{
    <!-- Category Selection View -->
    <div class="cls_section1 rounded">
        <div class="cls_section2">
            <div class="cls_container_div4">
                <h4 class="cls_section_label">Planogram Category List</h4>
                <div class="cls_section_div">
                    @if (_viewModel.Categories != null && _viewModel.Categories.Any())
                    {
                        <div class="category-grid">
                            @foreach (var category in _viewModel.Categories)
                            {
                                <div class="category-card" @onclick="() => SelectCategory(category.CategoryCode)">
                                    <div class="category-image">
                                        <img src="@($"{_appConfigs.ApiDataBaseUrl}{category.CategoryImage}")"
                                             alt="@category.CategoryName"
                                             onerror="this.src='/Data/SKU/no_image_available.jpg'" />
                                    </div>
                                    <div class="category-name">@category.CategoryName</div>
                                    @if (category.SetupCount > 0)
                                    {
                                         <div class="category-badge">
                                            <i>
                                                <img style="width:18px;" src="/Images/Righttick.png" b-kixad4cnrw="">
                                                
                                            </i>
                                        </div> 
                                    }
                                </div>
                            }
                        </div>
                    }
                    else if (_viewModel.IsLoadingCategories)
                    {
                        <div class="loading-spinner">
                            <p>Loading categories...</p>
                        </div>
                    }
                    else
                    {
                        <div class="no-data">
                            <p>No categories available</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="cls_dashboard_7 dn" style="display:none;">
        <button class="cls_btn_check2" @onclick="ProceedToExecution" disabled="@(string.IsNullOrEmpty(_viewModel.SelectedCategoryCode))">
            PROCEED
        </button>
    </div>
}
else
{
    <!-- Planogram Execution View -->
    <div class="cls_section1 rounded">
        <div class="cls_section2">
            <!-- Header -->
            <div class="cls_container_div4">
                <div class="cls_mm_div">
                    <h3>@_viewModel.SelectedCategoryCode</h3>
                    <p>Adress1</p>
                </div>
                
                <div class="category-header">
                
                    <button class="back-button" style="display:none;" @onclick="BackToCategories">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </div>
                
                <div class="cls_section_div">
                    <!-- Recommended Image Section -->
                    <label class="cls_section_label1">Recommended Image:</label>
                    @if (!string.IsNullOrEmpty(_viewModel.RecommendedImagePath))
                    {
                        <img src="@($"{_appConfigs.ApiDataBaseUrl}{_viewModel.RecommendedImagePath}")"
                             style="max-width: 100%; height:30vh; display: block; margin: 0 auto;"
                             alt="RecommendedImage" />

                          
                    }
                    else
                    {
                        <div class="no-image-placeholder">
                            <img style="width:100%;" src="/Images/noimage.png" b-kixad4cnrw="">
                        </div>
                    }
                </div>
                
                <div class="cls_container_div">
                    <h7 class="cls_section_label1">Execution Image:</h7>
                    <div class="mt-3">
                        <FileCapture OnImageDeleteClick="OnImageDeleteClick"
                                     OnImageCapture="OnImageCapture"
                                     FolderPath=@folderPath
                                     FileName="Planogram"
                                     CaptureData="fileCaptureData">
                        </FileCapture>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="cls_dashboard_7">
        <button class="cls_btn_check2" @onclick="SubmitPlanogram" >
            Submit
        </button>
    </div> @* disabled="@(!_viewModel.IsImageCaptured)" *@
}